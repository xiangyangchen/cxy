## #仿真维护手册（老方法）

自己电脑部署仿真环境

```shell
#!/usr/bin/env bash
#本地启动仿真环境的docker启动脚本
docker stop A001 && docker rm A001
xhost +
echo "Checking whether we are running as root"
if [ "$(id -u)" -ne 0 ]; then
  echo
else
  echo "Please DO NOT run the build script as root"
  exit
fi

docker run -it -d \
  --privileged=true \
  --net host \
  --name A001 \
  -p 8080:8080 \
  -e NVIDIA_DRIVER_CAPABILITIES=compute,utility,graphics \
  -e RMW_IMPLEMENTATION=rmw_cyclonedds_cpp \
  -e QOMOLO_ROBOT_ID=A001 \
  -e ROS_DOMAIN_ID=132 \
  -e ROS_MAP_ID=qp \
  -e LOG_PATH=/tmp \
	-e MQTT_NAMESPACE=A006 \
	-e MQTT_SERVER_IP=113.31.113.98 \     #toc_sim ip
	-e MQTT_SERVER_PORT=19000 \              #toc_sim port
	-e USE_RVIZ=True \
	-e DISPLAY=unix$DISPLAY \
  -e CMAKE_PREFIX_PATH=/opt/third_party/casadi/lib/cmake/casadi:/opt/third_party/ceres/lib/cmake/Ceres:/opt/third_party/osqp-cpp/lib/cmake/:/opt/third_party/abseil-cpp/lib/cmake/:/opt/third_party/osqp/lib/cmake/ \
  -e LD_LIBRARY_PATH=/opt/third_party/pangolin/lib:/opt/third_party/casadi/lib:/opt/opencv/lib/cmake/opencv4:/opt/third_party/osqp-cpp/lib/:/opt/third_party/abseil-cpp/lib/:/opt/third_party/osqp/lib/ \
  -e CPLUS_INCLUDE_PATH=/opt/third_party/osqp/include/ \
	-e ROS_WORKSPACE=qpilot2_ws \
	-e GDK_SCALE \
	-e GDK_DPI_SCALE \
  -e CXX=/usr/bin/g++ \
  -v /tmp:/tmp \
	-v /dev:/dev \
	-v /etc/localtime:/etc/localtime \
	-v /opt/qomolo:/opt/qomolo \
	-v /home/westwell:/home/westwell \
  	-v ~/qpilot2_ws:/debug \
  harbor.qomolo.com/ros2/foxy/foxy-focal-runtime \
  /bin/bash

```

上为启动脚本

```shell
sudo wget https://repo.qomolo.com/repository/raw/gpg/public.gpg.key -O- | sudo apt-key add
echo "deb [arch=amd64] https://repo.qomolo.com/repository/alpha/ focal main" | sudo tee  /etc/apt/sources.list.d/qomolo-foxy.list          ##add qomolo apt source
sudo apt update
```

```shell
 sudo apt install ws-onsite-ws-simstraddle-ng            #安装固件
```



```shell
 export VOC_SERVER_URL="http://ip:port"        #需要链接的toc    ip/port      #也可以写到代码里
  source /opt/qomolo/qpilot/setup.bash
  FLASK_APP=/opt/qomolo/qpilot/lib/python3.8/site-packages/ros2_http_bridge/scripts/http_bridge_logpush.py flask run --port=8080 --host=0.0.0.0
```



以下内容进入docker内操作：

```shell
source /opt/qomolo/ws_simstraddle_ng/setup.bash 
 ros2 launch agent_bringup single.launch.py                  #启动假的agent 发送数据
 
 #示例
  export VOC_SERVER_URL="http://ip:port"        #需要链接的toc    ip/port      #也可以写到代码里
  source /opt/qomolo/qpilot/setup.bash
  FLASK_APP=/opt/qomolo/qpilot/lib/python3.8/site-packages/ros2_http_bridge/scripts/http_bridge_logpush.py flask run --port=8080 --host=0.0.0.0
```

